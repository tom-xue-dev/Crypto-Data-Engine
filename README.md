# Crypto Data Engine

> ä¸“ä¸šçš„åŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“å›æµ‹ç³»ç»Ÿ

ä¸€ä¸ªå®Œæ•´çš„ç«¯åˆ°ç«¯é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œä»æ•°æ®ä¸‹è½½ã€Barèšåˆåˆ°ç­–ç•¥å›æµ‹ã€ç»“æœå¯è§†åŒ–å…¨æµç¨‹è¦†ç›–ã€‚

[![Python](https://img.shields.io/badge/Python-3.12-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.128-green.svg)](https://fastapi.tiangolo.com/)
[![React](https://img.shields.io/badge/React-18-61dafb.svg)](https://react.dev/)
[![Tests](https://img.shields.io/badge/Tests-60%20passed-success.svg)](./tests/)

---

## æ ¸å¿ƒç‰¹æ€§

### ğŸ“Š æ•°æ®å¤„ç†
- **å¤šäº¤æ˜“æ‰€æ”¯æŒ**: Binance, OKX, Bybit
- **å¤šç§Barç±»å‹**: TickBar, VolumeBar, DollarBar, TimeBar
- **é«˜æ€§èƒ½èšåˆ**: NumbaåŠ é€Ÿ + å¤šè¿›ç¨‹å¹¶è¡Œ
- **çµæ´»å­˜å‚¨**: Parquetæ ¼å¼ï¼Œæ”¯æŒå†…å­˜æ˜ å°„

### ğŸ¯ å›æµ‹å¼•æ“
- **ä¸‰ç§å›æµ‹æ¨¡å¼**: æ¨ªæˆªé¢ã€æ—¶é—´åºåˆ—ã€å¤šèµ„äº§æ—¶åº
- **å®Œæ•´ç»„åˆç®¡ç†**: å¤šç©ºä»“ä½ã€æ æ†ã€ä¿è¯é‡‘
- **ç²¾ç»†é£æ§**: æ­¢æŸã€è¿½è¸ªæ­¢æŸã€æœ€å¤§å›æ’¤é™åˆ¶
- **çœŸå®æˆæœ¬**: æ‰‹ç»­è´¹ã€æ»‘ç‚¹ã€èµ„é‡‘è´¹ç‡

### ğŸ“ äº¤æ˜“æ—¥å¿—
- **å…¨æ–¹ä½è®°å½•**: äº¤æ˜“ã€ä¿¡å·ã€é£æ§è§¦å‘ã€ç»„åˆå¿«ç…§
- **å¤šæ ¼å¼å¯¼å‡º**: JSONå®Œæ•´æ—¥å¿—ã€CSVè¡¨æ ¼
- **å®æ—¶ç»Ÿè®¡**: äº¤æ˜“æ‘˜è¦ã€èƒœç‡ã€ç›ˆäºåˆ†æ

### ğŸ¨ å¯è§†åŒ–å‰ç«¯
- **React + TypeScript + Ant Design**
- **EChartsäº¤äº’å¼å›¾è¡¨**: å‡€å€¼æ›²çº¿ã€å›æ’¤å›¾ã€æœˆåº¦çƒ­åŠ›å›¾
- **å®æ—¶ä»»åŠ¡ç›‘æ§**: çŠ¶æ€æ›´æ–°ã€è¿›åº¦è¿½è¸ª
- **å®Œæ•´æ—¥å¿—æŸ¥è¯¢**: æŒ‰èµ„äº§ã€æ—¶é—´ã€äº‹ä»¶ç±»å‹ç­›é€‰

---

## å¿«é€Ÿå¼€å§‹

### æœ€ç®€å¯åŠ¨ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. å®‰è£…ä¾èµ–
poetry install
cd frontend && npm install && cd ..

# 2. å¯åŠ¨åç«¯
poetry run main start

# 3. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend
npm run dev

# 4. è®¿é—®ç³»ç»Ÿ
# å‰ç«¯: http://localhost:5173
# APIæ–‡æ¡£: http://localhost:8000/docs
```

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ [QUICKSTART.md](./QUICKSTART.md)

---

## é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯ (React + Vite)                    â”‚
â”‚    Dashboard | Config | Result | TradeLog       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FastAPI æœåŠ¡                        â”‚
â”‚   Backtest | Download | Aggregate | Logs        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backtest   â”‚ â”‚ Bar        â”‚ â”‚ Data       â”‚
â”‚ Engine     â”‚ â”‚ Aggregator â”‚ â”‚ Downloader â”‚
â”‚            â”‚ â”‚            â”‚ â”‚            â”‚
â”‚ Portfolio  â”‚ â”‚ TickBar    â”‚ â”‚ ccxt       â”‚
â”‚ RiskMgr    â”‚ â”‚ DollarBar  â”‚ â”‚ API        â”‚
â”‚ TradingLog â”‚ â”‚ VolumeBar  â”‚ â”‚            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚               â”‚                â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚ Postgres â”‚  â”‚  Redis   â”‚  â”‚ Local Storage â”‚
â”‚  (ä»»åŠ¡)  â”‚  â”‚ (Celery) â”‚  â”‚   data/*      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒåŠŸèƒ½

### 1ï¸âƒ£ æ•°æ®æœåŠ¡

```bash
# ä¸‹è½½Tickæ•°æ®
curl -X POST "http://localhost:8000/api/v1/download/downloads/jobs" \
  -H "Content-Type: application/json" \
  -d '{
    "exchange": "binance",
    "symbols": ["BTCUSDT", "ETHUSDT"],
    "year": 2024,
    "months": [1, 2, 3]
  }'

# èšåˆä¸ºBaræ•°æ®
curl -X POST "http://localhost:8000/api/v1/aggregate/bars" \
  -H "Content-Type: application/json" \
  -d '{
    "exchange": "binance",
    "bar_type": "dollar_bar",
    "threshold": 1000000,
    "symbols": ["BTCUSDT"]
  }'
```

### 2ï¸âƒ£ å›æµ‹å¼•æ“

**é€šè¿‡CLIè¿è¡Œ**:

```bash
poetry run main backtest \
  --strategy momentum \
  --mode cross_sectional \
  --capital 1000000 \
  --start-date 2024-01-01 \
  --end-date 2024-06-30
```

**é€šè¿‡APIè¿è¡Œ**:

```bash
curl -X POST "http://localhost:8000/api/backtest/run" \
  -H "Content-Type: application/json" \
  -d '{
    "strategy": {"name": "long_short", "params": {"long_count": 10, "short_count": 10}},
    "mode": "cross_sectional",
    "initial_capital": 1000000,
    "rebalance_frequency": "W-MON"
  }'
```

### 3ï¸âƒ£ äº¤æ˜“æ—¥å¿—

```bash
# è·å–æ‰€æœ‰äº¤æ˜“è®°å½•
curl http://localhost:8000/api/backtest/logs/{task_id}/trades

# è·å–ç­–ç•¥ä¿¡å·
curl http://localhost:8000/api/backtest/logs/{task_id}/signals

# å¯¼å‡ºå®Œæ•´æ—¥å¿—
curl "http://localhost:8000/api/backtest/logs/{task_id}/export?format=json" \
  -o backtest_log.json
```

---

## CLIå‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `main start` | å¯åŠ¨FastAPIæœåŠ¡ |
| `main init-config` | ç”Ÿæˆé…ç½®æ¨¡æ¿ |
| `main init-db` | åˆå§‹åŒ–æ•°æ®åº“ |
| `main run-worker <module>` | å¯åŠ¨Celery Worker |
| `main backtest` | è¿è¡Œå›æµ‹ï¼ˆå‘½ä»¤è¡Œï¼‰ |
| `main test` | è¿è¡Œæµ‹è¯• |
| `main frontend` | å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ |

å®Œæ•´CLIå¸®åŠ©: `poetry run main --help`

---

## å›æµ‹ç³»ç»Ÿäº®ç‚¹

### ğŸ¯ å¤šæ¨¡å¼æ”¯æŒ

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | è°ƒä»“é¢‘ç‡ |
|------|----------|----------|
| æ¨ªæˆªé¢ (Cross-Sectional) | å› å­ç­–ç•¥ã€å¤šç©ºå¯¹å†² | å›ºå®šå‘¨æœŸï¼ˆæ—¥/å‘¨/æœˆï¼‰ |
| æ—¶é—´åºåˆ— (Time-Series) | è¶‹åŠ¿è·Ÿè¸ªã€æŠ€æœ¯åˆ†æ | æ¯ä¸ªBar |
| å¤šèµ„äº§æ—¶åº (Multi-Asset) | DollarBarç­–ç•¥ | éå¯¹é½Bar |

### ğŸ“Š èµ„äº§æ± ç®¡ç†

åŠ¨æ€èµ„äº§é€‰æ‹©ï¼Œæ”¯æŒï¼š
- æˆäº¤é¢Top K
- æ³¢åŠ¨ç‡ç­›é€‰
- æµåŠ¨æ€§ç­›é€‰
- è‡ªå®šä¹‰å› å­æ’åº

ç¤ºä¾‹é…ç½®ï¼š

```python
AssetPoolConfig(
    method="turnover_top_k",
    top_k=100,              # é€‰æ‹©Top100
    lookback_days=30,       # è¿‡å»30å¤©
    rebalance_frequency="MS",  # æ¯æœˆåˆæ›´æ–°
)
```

### ğŸ›¡ï¸ é£æ§ç³»ç»Ÿ

- **ä»“ä½é™åˆ¶**: å•ä»“/æ€»æ•å£/æ æ†æ§åˆ¶
- **æ­¢æŸç­–ç•¥**: å›ºå®šæ­¢æŸã€è¿½è¸ªæ­¢æŸã€ATRæ­¢æŸ
- **å›æ’¤æ§åˆ¶**: æœ€å¤§å›æ’¤ã€æ—¥å†…äºæŸé™åˆ¶
- **é£é™©è§¦å‘è®°å½•**: å®Œæ•´æ—¥å¿—è¿½æº¯

### ğŸ’° æˆæœ¬æ¨¡å‹

- **äº¤æ˜“æˆæœ¬**: Maker/Takerè´¹ç‡ã€æ»‘ç‚¹
- **æŒä»“æˆæœ¬**: èµ„é‡‘è´¹ç‡ã€æ æ†åˆ©æ¯
- **å‘¨æœŸç»“ç®—**: è‡ªåŠ¨è®¡ç®—æŒä»“è´¹ç”¨

---

## æµ‹è¯•

```bash
# è¿è¡Œå…¨éƒ¨æµ‹è¯• (60ä¸ªæµ‹è¯•ç”¨ä¾‹)
poetry run main test

# è¿è¡Œç‰¹å®šæµ‹è¯•
poetry run main test --file test_trading_log.py

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
poetry run main test --coverage
```

**æµ‹è¯•è¦†ç›–**:
- âœ… TradingLoggerå•å…ƒæµ‹è¯• (22ä¸ª)
- âœ… BacktestEngineé›†æˆæµ‹è¯• (14ä¸ª)
- âœ… APIç«¯ç‚¹æµ‹è¯• (24ä¸ª)

---

## æ•°æ®ç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ tick_data/              # TickåŸå§‹æ•°æ®
â”‚   â””â”€â”€ binance/
â”‚       â””â”€â”€ BTCUSDT/
â”‚           â””â”€â”€ 2024-01.parquet
â”‚
â”œâ”€â”€ bar_data/               # èšåˆBaræ•°æ®
â”‚   â”œâ”€â”€ tick_bar/
â”‚   â”œâ”€â”€ dollar_bar/
â”‚   â””â”€â”€ volume_bar/
â”‚
â”œâ”€â”€ backtest_logs/          # å›æµ‹æ—¥å¿—
â”‚   â””â”€â”€ {task_id}/
â”‚       â”œâ”€â”€ backtest_full_log.json
â”‚       â”œâ”€â”€ backtest_trades.csv
â”‚       â””â”€â”€ backtest_snapshots.csv
â”‚
â””â”€â”€ config/
    â””â”€â”€ config_templates/   # é…ç½®æ¨¡æ¿
```

---

## å‰ç«¯ç•Œé¢é¢„è§ˆ

### Dashboard - å›æµ‹ä»»åŠ¡ç®¡ç†
- ä»»åŠ¡åˆ—è¡¨ï¼ˆçŠ¶æ€ã€è¿›åº¦ã€åˆ›å»ºæ—¶é—´ï¼‰
- ç»Ÿè®¡å¡ç‰‡ï¼ˆæ€»ä»»åŠ¡ã€å·²å®Œæˆã€è¿è¡Œä¸­ã€å¤±è´¥ï¼‰
- å¿«é€Ÿæ“ä½œï¼ˆæ–°å»ºã€æŸ¥çœ‹ã€åˆ é™¤ï¼‰

### BacktestConfig - ç­–ç•¥é…ç½®
- ç­–ç•¥é€‰æ‹©ï¼ˆåŠ¨é‡ã€å‡å€¼å›å½’ã€å¤šç©ºå¯¹å†²ï¼‰
- å‚æ•°è®¾ç½®ï¼ˆå›çœ‹å‘¨æœŸã€æŒä»“æ•°é‡ï¼‰
- é£æ§é…ç½®ï¼ˆæ­¢æŸã€æœ€å¤§å›æ’¤ï¼‰
- æˆæœ¬è®¾ç½®ï¼ˆæ‰‹ç»­è´¹ã€æ»‘ç‚¹ï¼‰

### BacktestResult - ç»“æœåˆ†æ
- å…³é”®æŒ‡æ ‡å¡ç‰‡ï¼ˆæ€»æ”¶ç›Šã€å¹´åŒ–ã€å¤æ™®ã€å›æ’¤ã€èƒœç‡ï¼‰
- å‡€å€¼æ›²çº¿ + å›æ’¤å›¾ï¼ˆåŒYè½´è”åŠ¨ã€å¯ç¼©æ”¾ï¼‰
- æœˆåº¦æ”¶ç›Šçƒ­åŠ›å›¾
- äº¤æ˜“ç›ˆäºæ•£ç‚¹å›¾

### TradeLog - äº¤æ˜“æ˜ç»†
- äº¤æ˜“è®°å½•è¡¨ï¼ˆå¼€å¹³ä»“ã€ä»·æ ¼ã€ç›ˆäºï¼‰
- ç­–ç•¥ä¿¡å·æ—¥å¿—ï¼ˆæ‰§è¡Œ/æ‹’ç»åŸå› ï¼‰
- æŒä»“å¿«ç…§ï¼ˆNAVã€æ•å£ã€æ æ†ï¼‰
- å¯¼å‡ºåŠŸèƒ½ï¼ˆJSON/CSVï¼‰

---

## ç¤ºä¾‹ç­–ç•¥

### å‘¨æ¶¨å¹…å‡å€¼å›å½’ç­–ç•¥

æ¯å‘¨ä¸€è°ƒä»“:
- èµ„äº§æ± : æ¯æœˆ1å·æ›´æ–°ï¼Œé€‰æ‹©è¿‡å»30å¤©æˆäº¤é¢Top100
- åšå¤š: ä¸Šå‘¨æ¶¨å¹…æœ€å°ï¼ˆè·Œå¹…æœ€å¤§ï¼‰çš„10ä¸ªèµ„äº§
- åšç©º: ä¸Šå‘¨æ¶¨å¹…æœ€å¤§ï¼ˆè·Œå¹…æœ€å°ï¼‰çš„10ä¸ªèµ„äº§
- æƒé‡: å„50%èµ„é‡‘ï¼Œå‡ä»“åˆ†é…

```python
from crypto_data_engine.services.back_test.strategies import LongShortStrategy

strategy = LongShortStrategy(
    long_count=10,
    short_count=10,
    factor="weekly_return",
    reverse_long=True,  # åšå¤šè·Œå¹…å¤§çš„ï¼ˆå‡å€¼å›å½’ï¼‰
)
```

---

## æŠ€æœ¯æ ˆ

### åç«¯
- **Webæ¡†æ¶**: FastAPI 0.128
- **æ•°æ®å¤„ç†**: Pandas, NumPy, PyArrow
- **åŠ é€Ÿ**: Numba (JITç¼–è¯‘)
- **æ•°æ®åº“**: PostgreSQL + SQLAlchemy
- **ä»»åŠ¡é˜Ÿåˆ—**: Celery + Redis (å¯é€‰)
- **å¯è§†åŒ–**: Matplotlib

### å‰ç«¯
- **æ¡†æ¶**: React 18 + TypeScript
- **UIåº“**: Ant Design 5
- **å›¾è¡¨**: ECharts
- **çŠ¶æ€ç®¡ç†**: React Query
- **æ„å»º**: Vite

---

## æ–‡æ¡£

- [ğŸ“– å®Œæ•´é¡¹ç›®æŒ‡å—](./docs/PROJECT_GUIDE.md)
- [ğŸš€ å¿«é€Ÿå¯åŠ¨](./QUICKSTART.md)
- [ğŸ”§ å›æµ‹ç³»ç»Ÿæ–‡æ¡£](./docs/BACKTEST_SYSTEM.md)
- [ğŸ“¡ APIæ–‡æ¡£](http://localhost:8000/docs) (éœ€å¯åŠ¨æœåŠ¡)

---

## æ€§èƒ½ä¼˜åŒ–

- âœ… PyArrow + mmap å¿«é€Ÿè¯»å–Parquet
- âœ… Numba JITç¼–è¯‘åŠ é€ŸBarèšåˆ
- âœ… å¤šè¿›ç¨‹å¹¶è¡Œå¤„ç†å¤šä¸ªäº¤æ˜“å¯¹
- âœ… Pandaså‘é‡åŒ–è®¡ç®—
- âœ… äº‹ä»¶é©±åŠ¨æ¶æ„å‡å°‘å†—ä½™è®¡ç®—

---

## å¼€å‘è·¯çº¿å›¾

- [x] Tickæ•°æ®ä¸‹è½½æœåŠ¡
- [x] å¤šç§Barèšåˆå™¨
- [x] æ¨ªæˆªé¢/æ—¶åºå›æµ‹å¼•æ“
- [x] èµ„äº§æ± åŠ¨æ€ç®¡ç†
- [x] äº¤æ˜“æ—¥å¿—ç³»ç»Ÿ
- [x] Reactå‰ç«¯ç•Œé¢
- [x] å®Œæ•´æµ‹è¯•å¥—ä»¶
- [ ] å®æ—¶æ•°æ®æµï¼ˆWebSocketï¼‰
- [ ] åˆ†å¸ƒå¼å›æµ‹ï¼ˆRayï¼‰
- [ ] ç­–ç•¥ä¼˜åŒ–å™¨
- [ ] PDFæŠ¥å‘Šç”Ÿæˆ
- [ ] å‚æ•°ç½‘æ ¼æœç´¢

---

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

---

## è®¸å¯è¯

MIT License

---

## è‡´è°¢

æœ¬é¡¹ç›®æ•´åˆäº†å¤šä¸ªä¼˜ç§€å¼€æºé¡¹ç›®çš„ç†å¿µå’Œæœ€ä½³å®è·µã€‚

---

**é—®é¢˜åé¦ˆ**: GitHub Issues  
**æœ€åæ›´æ–°**: 2026-01-30
